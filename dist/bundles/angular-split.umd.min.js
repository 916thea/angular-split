!function(global,factory){"object"==typeof exports&&"undefined"!=typeof module?factory(exports,require("@angular/core"),require("@angular/common"),require("rxjs/Subject"),require("rxjs/add/operator/debounceTime")):"function"==typeof define&&define.amd?define(["exports","@angular/core","@angular/common","rxjs/Subject","rxjs/add/operator/debounceTime"],factory):factory((global.ng=global.ng||{},global.ng.angularSplit={}),global.ng.core,global.ng.common,global.Rx)}(this,function(exports,core,common,Subject){"use strict";var SplitComponent=function(){function SplitComponent(cdRef,elementRef,renderer){this.cdRef=cdRef,this.elementRef=elementRef,this.renderer=renderer,this.direction="horizontal",this.gutterSize=10,this.disabled=!1,this.visibleTransition=!1,this.dragStart=new core.EventEmitter(!1),this.dragProgress=new core.EventEmitter(!1),this.dragEnd=new core.EventEmitter(!1),this.visibleTransitionEndInternal=new Subject.Subject,this.visibleTransitionEnd=this.visibleTransitionEndInternal.asObservable().debounceTime(20),this.areas=[],this.minPercent=5,this.isDragging=!1,this.containerSize=0,this.areaASize=0,this.areaBSize=0,this.eventsDragFct=[]}return Object.defineProperty(SplitComponent.prototype,"styleFlexDirection",{get:function(){return"vertical"===this.direction},enumerable:!0,configurable:!0}),Object.defineProperty(SplitComponent.prototype,"styleFlexDirectionStyle",{get:function(){return"horizontal"===this.direction?"row":"column"},enumerable:!0,configurable:!0}),Object.defineProperty(SplitComponent.prototype,"dragging",{get:function(){return!this.visibleTransition||this.isDragging},enumerable:!0,configurable:!0}),Object.defineProperty(SplitComponent.prototype,"styleWidth",{get:function(){return this.width&&!isNaN(this.width)&&this.width>0?this.width+"px":"100%"},enumerable:!0,configurable:!0}),Object.defineProperty(SplitComponent.prototype,"styleHeight",{get:function(){return this.height&&!isNaN(this.height)&&this.height>0?this.height+"px":"100%"},enumerable:!0,configurable:!0}),Object.defineProperty(SplitComponent.prototype,"visibleAreas",{get:function(){return this.areas.filter(function(a){return a.component.visible})},enumerable:!0,configurable:!0}),Object.defineProperty(SplitComponent.prototype,"nbGutters",{get:function(){return this.visibleAreas.length-1},enumerable:!0,configurable:!0}),SplitComponent.prototype.ngOnChanges=function(changes){(changes.gutterSize||changes.disabled)&&this.refresh()},SplitComponent.prototype.addArea=function(component,orderUser,sizeUser,minPixel){this.areas.push({component:component,orderUser:orderUser,order:-1,sizeUser:sizeUser,size:-1,minPixel:minPixel}),this.refresh()},SplitComponent.prototype.updateArea=function(component,orderUser,sizeUser,minPixel){var item=this.areas.find(function(a){return a.component===component});item&&(item.orderUser=orderUser,item.sizeUser=sizeUser,item.minPixel=minPixel,this.refresh())},SplitComponent.prototype.removeArea=function(area){var item=this.areas.find(function(a){return a.component===area});if(item){var index=this.areas.indexOf(item);this.areas.splice(index,1),this.areas.forEach(function(a,i){return a.order=2*i}),this.refresh()}},SplitComponent.prototype.hideArea=function(area){this.areas.find(function(a){return a.component===area})&&this.refresh()},SplitComponent.prototype.showArea=function(area){this.areas.find(function(a){return a.component===area})&&this.refresh()},SplitComponent.prototype.isLastVisibleArea=function(area){return this.visibleAreas.length>0&&area===this.visibleAreas[this.visibleAreas.length-1]},SplitComponent.prototype.refresh=function(){var _this=this;this.stopDragging(),this.areas.filter(function(a){return null!==a.orderUser&&!isNaN(a.orderUser)}).length===this.areas.length&&this.areas.sort(function(a,b){return Number(a.orderUser)-Number(b.orderUser)}),this.areas.forEach(function(a,i){a.order=2*i,a.component.setStyle("order",a.order)});var totalSize=this.visibleAreas.map(function(a){return a.sizeUser}).reduce(function(acc,s){return acc+s},0),nbCorrectSize=this.visibleAreas.filter(function(a){return null!==a.sizeUser&&!isNaN(a.sizeUser)&&a.sizeUser>=_this.minPercent}).length;if(totalSize<99.99||totalSize>100.01||nbCorrectSize!==this.visibleAreas.length){var size_1=Number((100/this.visibleAreas.length).toFixed(3));this.visibleAreas.forEach(function(a){return a.size=size_1})}else this.visibleAreas.forEach(function(a){return a.size=Number(a.sizeUser)});this.refreshStyleSizes(),this.cdRef.markForCheck()},SplitComponent.prototype.refreshStyleSizes=function(){var f=this.gutterSize*this.nbGutters/this.visibleAreas.length;this.visibleAreas.forEach(function(a){return a.component.setStyle("flex-basis","calc( "+a.size+"% - "+f+"px )")})},SplitComponent.prototype.startDragging=function(startEvent,gutterOrder){var _this=this;if(startEvent.preventDefault(),!this.disabled){var areaA=this.areas.find(function(a){return a.order===gutterOrder-1}),areaB=this.areas.find(function(a){return a.order===gutterOrder+1});if(areaA&&areaB){var prop="horizontal"===this.direction?"offsetWidth":"offsetHeight";this.containerSize=this.elementRef.nativeElement[prop],this.areaASize=this.containerSize*areaA.size/100,this.areaBSize=this.containerSize*areaB.size/100;var start;if(startEvent instanceof MouseEvent)start={x:startEvent.screenX,y:startEvent.screenY};else{if(!(startEvent instanceof TouchEvent))return;start={x:startEvent.touches[0].screenX,y:startEvent.touches[0].screenY}}this.eventsDragFct.push(this.renderer.listenGlobal("document","mousemove",function(e){return _this.dragEvent(e,start,areaA,areaB)})),this.eventsDragFct.push(this.renderer.listenGlobal("document","touchmove",function(e){return _this.dragEvent(e,start,areaA,areaB)})),this.eventsDragFct.push(this.renderer.listenGlobal("document","mouseup",function(e){return _this.stopDragging()})),this.eventsDragFct.push(this.renderer.listenGlobal("document","touchend",function(e){return _this.stopDragging()})),this.eventsDragFct.push(this.renderer.listenGlobal("document","touchcancel",function(e){return _this.stopDragging()})),areaA.component.lockEvents(),areaB.component.lockEvents(),this.isDragging=!0,this.notify("start")}}},SplitComponent.prototype.dragEvent=function(event,start,areaA,areaB){if(this.isDragging){var end;if(event instanceof MouseEvent)end={x:event.screenX,y:event.screenY};else{if(!(event instanceof TouchEvent))return;end={x:event.touches[0].screenX,y:event.touches[0].screenY}}this.drag(start,end,areaA,areaB)}},SplitComponent.prototype.drag=function(start,end,areaA,areaB){var offsetPixel="horizontal"===this.direction?start.x-end.x:start.y-end.y,newSizePixelA=this.areaASize-offsetPixel,newSizePixelB=this.areaBSize+offsetPixel;if(!(newSizePixelA<=areaA.minPixel&&newSizePixelB<areaB.minPixel)){var newSizePercentA=newSizePixelA/this.containerSize*100,newSizePercentB=newSizePixelB/this.containerSize*100;newSizePercentA<=this.minPercent?(newSizePercentA=this.minPercent,newSizePercentB=areaA.size+areaB.size-this.minPercent):newSizePercentB<=this.minPercent?(newSizePercentB=this.minPercent,newSizePercentA=areaA.size+areaB.size-this.minPercent):(newSizePercentA=Number(newSizePercentA.toFixed(3)),newSizePercentB=Number((areaA.size+areaB.size-newSizePercentA).toFixed(3))),areaA.size=newSizePercentA,areaB.size=newSizePercentB,this.refreshStyleSizes(),this.notify("progress")}},SplitComponent.prototype.stopDragging=function(){if(this.isDragging){for(this.areas.forEach(function(a){return a.component.unlockEvents()});this.eventsDragFct.length>0;){var fct=this.eventsDragFct.pop();fct&&fct()}this.containerSize=0,this.areaASize=0,this.areaBSize=0,this.isDragging=!1,this.notify("end")}},SplitComponent.prototype.notify=function(type){var data=this.visibleAreas.map(function(a){return a.size});switch(type){case"start":return this.dragStart.emit(data);case"progress":return this.dragProgress.emit(data);case"end":return this.dragEnd.emit(data);case"visibleTransitionEnd":return this.visibleTransitionEndInternal.next(data)}},SplitComponent.prototype.ngOnDestroy=function(){this.stopDragging()},SplitComponent.decorators=[{type:core.Component,args:[{selector:"split",changeDetection:core.ChangeDetectionStrategy.OnPush,styles:["\n        :host {\n            display: flex;\n            flex-wrap: nowrap;\n            justify-content: flex-start;\n            align-items: stretch;\n            flex-direction: row;\n        }\n\n        :host.vertical {\n            flex-direction: column;\n        }\n\n        split-gutter {\n            flex-grow: 0;\n            flex-shrink: 0;\n            background-color: #eeeeee;\n            background-position: center center;\n            background-repeat: no-repeat;\n        }\n\n        :host.vertical split-gutter {\n            width: 100%;\n        }\n\n        :host /deep/ split-area {\n            transition: flex-basis 0.3s;\n        }  \n\n        :host.notransition /deep/ split-area {\n            transition: none !important;\n        }      \n\n        :host /deep/ split-area.hided {\n            flex-basis: 0 !important;\n            overflow: hidden !important;\n        }      \n\n        :host.vertical /deep/ split-area.hided {\n            max-width: 0;\n        }\n    "],template:'\n        <ng-content></ng-content>\n        <ng-template ngFor let-area [ngForOf]="areas" let-index="index" let-last="last">\n            <split-gutter *ngIf="last === false && area.component.visible === true && !isLastVisibleArea(area)" \n                          [order]="index*2+1"\n                          [direction]="direction"\n                          [size]="gutterSize"\n                          [disabled]="disabled"\n                          (mousedown)="startDragging($event, index*2+1)"\n                          (touchstart)="startDragging($event, index*2+1)"></split-gutter>\n        </ng-template>'}]}],SplitComponent.ctorParameters=function(){return[{type:core.ChangeDetectorRef},{type:core.ElementRef},{type:core.Renderer}]},SplitComponent.propDecorators={direction:[{type:core.Input}],width:[{type:core.Input}],height:[{type:core.Input}],gutterSize:[{type:core.Input}],disabled:[{type:core.Input}],visibleTransition:[{type:core.Input}],dragStart:[{type:core.Output}],dragProgress:[{type:core.Output}],dragEnd:[{type:core.Output}],visibleTransitionEnd:[{type:core.Output}],styleFlexDirection:[{type:core.HostBinding,args:["class.vertical"]}],styleFlexDirectionStyle:[{type:core.HostBinding,args:["style.flex-direction"]}],dragging:[{type:core.HostBinding,args:["class.notransition"]}],styleWidth:[{type:core.HostBinding,args:["style.width"]}],styleHeight:[{type:core.HostBinding,args:["style.height"]}]},SplitComponent}(),SplitAreaDirective=function(){function SplitAreaDirective(elementRef,renderer,split){this.elementRef=elementRef,this.renderer=renderer,this.split=split,this._order=null,this._size=null,this._minSizePixel=0,this._visible=!0,this.visibility="block",this.eventsLockFct=[]}return Object.defineProperty(SplitAreaDirective.prototype,"order",{set:function(v){this._order=isNaN(v)?null:v,this.split.updateArea(this,this._order,this._size,this._minSizePixel)},enumerable:!0,configurable:!0}),Object.defineProperty(SplitAreaDirective.prototype,"size",{set:function(v){this._size=isNaN(v)?null:v,this.split.updateArea(this,this._order,this._size,this._minSizePixel)},enumerable:!0,configurable:!0}),Object.defineProperty(SplitAreaDirective.prototype,"minSizePixel",{set:function(v){this._minSizePixel=!isNaN(v)&&v>0?v:0,this.split.updateArea(this,this._order,this._size,this._minSizePixel)},enumerable:!0,configurable:!0}),Object.defineProperty(SplitAreaDirective.prototype,"visible",{get:function(){return this._visible},set:function(v){this.visibility=v?"block":"none",this._visible=v,this.visible?this.split.showArea(this):this.split.hideArea(this)},enumerable:!0,configurable:!0}),SplitAreaDirective.prototype.ngOnInit=function(){this.split.addArea(this,this._order,this._size,this._minSizePixel)},SplitAreaDirective.prototype.lockEvents=function(){this.eventsLockFct.push(this.renderer.listen(this.elementRef.nativeElement,"selectstart",function(e){return!1})),this.eventsLockFct.push(this.renderer.listen(this.elementRef.nativeElement,"dragstart",function(e){return!1}))},SplitAreaDirective.prototype.unlockEvents=function(){for(;this.eventsLockFct.length>0;){var fct=this.eventsLockFct.pop();fct&&fct()}},SplitAreaDirective.prototype.setStyle=function(key,value){this.renderer.setElementStyle(this.elementRef.nativeElement,key,value)},SplitAreaDirective.prototype.ngOnDestroy=function(){this.split.removeArea(this)},SplitAreaDirective.prototype.onTransitionEnd=function(evt){"flex-basis"===evt.propertyName&&this.split.notify("visibleTransitionEnd")},SplitAreaDirective.decorators=[{type:core.Directive,args:[{selector:"split-area",host:{"[style.flex-grow]":'"0"',"[style.flex-shrink]":'"0"',"[style.overflow-x]":'"hidden"',"[style.overflow-y]":'"auto"',"[style.height]":'"100%"',"[class.hided]":"!visible","(transitionend)":"onTransitionEnd($event)"}}]}],SplitAreaDirective.ctorParameters=function(){return[{type:core.ElementRef},{type:core.Renderer},{type:SplitComponent}]},SplitAreaDirective.propDecorators={order:[{type:core.Input}],size:[{type:core.Input}],minSizePixel:[{type:core.Input}],visible:[{type:core.Input}]},SplitAreaDirective}(),SplitGutterDirective=function(){function SplitGutterDirective(elementRef,renderer){this.elementRef=elementRef,this.renderer=renderer,this._disabled=!1}return Object.defineProperty(SplitGutterDirective.prototype,"order",{set:function(v){this.setStyle("order",v)},enumerable:!0,configurable:!0}),Object.defineProperty(SplitGutterDirective.prototype,"direction",{set:function(v){this._direction=v,this.refreshStyle()},enumerable:!0,configurable:!0}),Object.defineProperty(SplitGutterDirective.prototype,"size",{set:function(v){this._size=v,this.refreshStyle()},enumerable:!0,configurable:!0}),Object.defineProperty(SplitGutterDirective.prototype,"disabled",{set:function(v){this._disabled=v,this.refreshStyle()},enumerable:!0,configurable:!0}),SplitGutterDirective.prototype.refreshStyle=function(){this.setStyle("flex-basis",this._size+"px"),this.setStyle("height","vertical"===this._direction?this._size+"px":"100%");var state=!0===this._disabled?"disabled":this._direction;this.setStyle("cursor",this.getCursor(state)),this.setStyle("background-image",'url("'+this.getImage(state)+'")')},SplitGutterDirective.prototype.setStyle=function(key,value){this.renderer.setElementStyle(this.elementRef.nativeElement,key,value)},SplitGutterDirective.prototype.getCursor=function(state){switch(state){case"disabled":return"default";case"vertical":return"row-resize";case"horizontal":return"col-resize"}},SplitGutterDirective.prototype.getImage=function(state){switch(state){case"disabled":return"";case"vertical":return"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAFCAMAAABl/6zIAAAABlBMVEUAAADMzMzIT8AyAAAAAXRSTlMAQObYZgAAABRJREFUeAFjYGRkwIMJSeMHlBkOABP7AEGzSuPKAAAAAElFTkSuQmCC";case"horizontal":return"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAeCAYAAADkftS9AAAAIklEQVQoU2M4c+bMfxAGAgYYmwGrIIiDjrELjpo5aiZeMwF+yNnOs5KSvgAAAABJRU5ErkJggg=="}},SplitGutterDirective.decorators=[{type:core.Directive,args:[{selector:"split-gutter"}]}],SplitGutterDirective.ctorParameters=function(){return[{type:core.ElementRef},{type:core.Renderer}]},SplitGutterDirective.propDecorators={order:[{type:core.Input}],direction:[{type:core.Input}],size:[{type:core.Input}],disabled:[{type:core.Input}]},SplitGutterDirective}(),AngularSplitModule=function(){function AngularSplitModule(){}return AngularSplitModule.forRoot=function(){return{ngModule:AngularSplitModule,providers:[]}},AngularSplitModule.forChild=function(){return{ngModule:AngularSplitModule,providers:[]}},AngularSplitModule.decorators=[{type:core.NgModule,args:[{imports:[common.CommonModule],declarations:[SplitComponent,SplitAreaDirective,SplitGutterDirective],exports:[SplitComponent,SplitAreaDirective]}]}],AngularSplitModule.ctorParameters=function(){return[]},AngularSplitModule}();exports.AngularSplitModule=AngularSplitModule,exports.ɵa=SplitComponent,exports.ɵb=SplitAreaDirective,exports.ɵc=SplitGutterDirective,Object.defineProperty(exports,"__esModule",{value:!0})});